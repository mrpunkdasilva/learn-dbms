<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#E8488B"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2025-06-08T20:10:09.001199002"><title>Gerenciamento de Savepoints | Database Management Systems: A Complete Guide</title><script type="application/json" id="virtual-toc-data">[{"id":"introdu-o-aos-savepoints","level":0,"title":"Introdução aos Savepoints","anchor":"#introdu-o-aos-savepoints"},{"id":"comandos-b-sicos","level":0,"title":"Comandos Básicos","anchor":"#comandos-b-sicos"},{"id":"comportamento-dos-savepoints","level":0,"title":"Comportamento dos Savepoints","anchor":"#comportamento-dos-savepoints"},{"id":"casos-de-uso","level":0,"title":"Casos de Uso","anchor":"#casos-de-uso"},{"id":"pr-ticas-recomendadas","level":0,"title":"Práticas Recomendadas","anchor":"#pr-ticas-recomendadas"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><link href="static/custom.css" rel="stylesheet"><link rel="icon" type="image/svg" sizes="16x16" href="images/logo-primary.svg"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Gerenciamento de Savepoints | Database Management Systems: A Complete Guide"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Database Management Systems: A Complete Guide Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/savepoint-management.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Gerenciamento de Savepoints | Database Management Systems: A Complete Guide"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/savepoint-management.html#webpage",
    "url": "writerside-documentation/savepoint-management.html",
    "name": "Gerenciamento de Savepoints | Database Management Systems: A Complete Guide",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Database Management Systems: A Complete Guide Help"
}</script><!-- End Schema.org --></head><body data-id="savepoint-management" data-main-title="Gerenciamento de Savepoints" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="sql-fundamentals.md|Fundamentos SQL///sql-tcl.md|Linguagem de Controle de Transação (TCL)"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Database Management Systems: A Complete Guide  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="savepoint-management" id="savepoint-management.md">Gerenciamento de Savepoints</h1><section class="chapter"><h2 id="introdu-o-aos-savepoints" data-toc="introdu-o-aos-savepoints">Introdu&ccedil;&atilde;o aos Savepoints</h2><p id="-e4fwap_8">Savepoints s&atilde;o marcadores dentro de uma transa&ccedil;&atilde;o que permitem o rollback parcial, desfazendo apenas parte das opera&ccedil;&otilde;es realizadas, sem precisar abortar toda a transa&ccedil;&atilde;o.</p></section><section class="chapter"><h2 id="comandos-b-sicos" data-toc="comandos-b-sicos">Comandos B&aacute;sicos</h2><section class="chapter"><h3 id="cria-o-de-savepoint" data-toc="cria-o-de-savepoint">Cria&ccedil;&atilde;o de Savepoint</h3><div class="code-block" data-lang="sql">
SAVEPOINT nome_do_savepoint;
</div></section><section class="chapter"><h3 id="rollback-para-um-savepoint" data-toc="rollback-para-um-savepoint">Rollback para um Savepoint</h3><div class="code-block" data-lang="sql">
ROLLBACK TO [SAVEPOINT] nome_do_savepoint;
-- ou em alguns SGBDs
ROLLBACK TRANSACTION TO [SAVEPOINT] nome_do_savepoint;
</div></section><section class="chapter"><h3 id="libera-o-de-savepoint" data-toc="libera-o-de-savepoint">Libera&ccedil;&atilde;o de Savepoint</h3><p id="-e4fwap_15">Em alguns SGBDs, &eacute; poss&iacute;vel liberar um savepoint que n&atilde;o &eacute; mais necess&aacute;rio:</p><div class="code-block" data-lang="sql">
RELEASE SAVEPOINT nome_do_savepoint;
</div></section></section><section class="chapter"><h2 id="comportamento-dos-savepoints" data-toc="comportamento-dos-savepoints">Comportamento dos Savepoints</h2><section class="chapter"><h3 id="ciclo-de-vida" data-toc="ciclo-de-vida">Ciclo de Vida</h3><ul class="list _bullet" id="-e4fwap_20"><li class="list__item" id="-e4fwap_21"><p id="-e4fwap_25"><span class="control" id="-e4fwap_26">Cria&ccedil;&atilde;o</span>: Um savepoint &eacute; criado com o comando <code class="code" id="-e4fwap_27">SAVEPOINT</code></p></li><li class="list__item" id="-e4fwap_22"><p id="-e4fwap_28"><span class="control" id="-e4fwap_29">Uso</span>: Um savepoint pode ser usado como destino de um <code class="code" id="-e4fwap_30">ROLLBACK TO</code></p></li><li class="list__item" id="-e4fwap_23"><p id="-e4fwap_31"><span class="control" id="-e4fwap_32">Libera&ccedil;&atilde;o</span>: Um savepoint pode ser liberado explicitamente com <code class="code" id="-e4fwap_33">RELEASE SAVEPOINT</code></p></li><li class="list__item" id="-e4fwap_24"><p id="-e4fwap_34"><span class="control" id="-e4fwap_35">Descarte</span>: Todos os savepoints s&atilde;o descartados quando a transa&ccedil;&atilde;o &eacute; finalizada com <code class="code" id="-e4fwap_36">COMMIT</code> ou <code class="code" id="-e4fwap_37">ROLLBACK</code></p></li></ul></section><section class="chapter"><h3 id="aninhamento" data-toc="aninhamento">Aninhamento</h3><p id="-e4fwap_38">Savepoints podem ser aninhados, permitindo n&iacute;veis de granularidade no controle de transa&ccedil;&otilde;es:</p><div class="code-block" data-lang="sql">
BEGIN;
    INSERT INTO tabela1 VALUES (1);
    
    SAVEPOINT sp1;
    UPDATE tabela2 SET coluna1 = 'valor1';
    
    SAVEPOINT sp2;
    DELETE FROM tabela3 WHERE id = 5;
    
    -- Desfaz apenas o DELETE
    ROLLBACK TO sp2;
    
    -- Continua a transação
    INSERT INTO tabela4 VALUES (2);
    
    -- Desfaz o UPDATE e o INSERT em tabela4
    ROLLBACK TO sp1;
    
    -- Continua a transação
    UPDATE tabela5 SET coluna1 = 'valor2';
COMMIT;
</div></section><section class="chapter"><h3 id="comportamento-em-diferentes-sgbds" data-toc="comportamento-em-diferentes-sgbds">Comportamento em Diferentes SGBDs</h3><section class="chapter"><h4 id="postgresql" data-toc="postgresql">PostgreSQL</h4><ul class="list _bullet" id="-e4fwap_44"><li class="list__item" id="-e4fwap_46"><p id="-e4fwap_49">Suporta savepoints aninhados</p></li><li class="list__item" id="-e4fwap_47"><p id="-e4fwap_50">Permite <code class="code" id="-e4fwap_51">RELEASE SAVEPOINT</code></p></li><li class="list__item" id="-e4fwap_48"><p id="-e4fwap_52">Savepoints persistem ap&oacute;s <code class="code" id="-e4fwap_53">ROLLBACK TO</code></p></li></ul><div class="code-block" data-lang="sql">
BEGIN;
    INSERT INTO tabela VALUES (1);
    SAVEPOINT sp1;
    INSERT INTO tabela VALUES (2);
    SAVEPOINT sp2;
    INSERT INTO tabela VALUES (3);
    ROLLBACK TO sp1;
    -- Neste ponto, sp2 ainda existe, mas é inútil
    INSERT INTO tabela VALUES (4);
COMMIT;
-- Resultado: tabela contém valores 1 e 4
</div></section><section class="chapter"><h4 id="mysql" data-toc="mysql">MySQL</h4><ul class="list _bullet" id="-e4fwap_54"><li class="list__item" id="-e4fwap_55"><p id="-e4fwap_58">Suporta savepoints aninhados</p></li><li class="list__item" id="-e4fwap_56"><p id="-e4fwap_59">Permite <code class="code" id="-e4fwap_60">RELEASE SAVEPOINT</code></p></li><li class="list__item" id="-e4fwap_57"><p id="-e4fwap_61">Comportamento similar ao PostgreSQL</p></li></ul></section><section class="chapter"><h4 id="oracle" data-toc="oracle">Oracle</h4><ul class="list _bullet" id="-e4fwap_62"><li class="list__item" id="-e4fwap_64"><p id="-e4fwap_67">Suporta savepoints aninhados</p></li><li class="list__item" id="-e4fwap_65"><p id="-e4fwap_68">Permite <code class="code" id="-e4fwap_69">ROLLBACK TO</code> sem a palavra <code class="code" id="-e4fwap_70">SAVEPOINT</code></p></li><li class="list__item" id="-e4fwap_66"><p id="-e4fwap_71">N&atilde;o mant&eacute;m savepoints ap&oacute;s um rollback para um savepoint anterior</p></li></ul><div class="code-block" data-lang="sql">
BEGIN;
    INSERT INTO tabela VALUES (1);
    SAVEPOINT sp1;
    INSERT INTO tabela VALUES (2);
    SAVEPOINT sp2;
    INSERT INTO tabela VALUES (3);
    ROLLBACK TO sp1;
    -- Em Oracle, sp2 não existe mais neste ponto
COMMIT;
</div></section><section class="chapter"><h4 id="sql-server" data-toc="sql-server">SQL Server</h4><ul class="list _bullet" id="-e4fwap_72"><li class="list__item" id="-e4fwap_74"><p id="-e4fwap_77">Suporta savepoints</p></li><li class="list__item" id="-e4fwap_75"><p id="-e4fwap_78">Usa <code class="code" id="-e4fwap_79">SAVE TRANSACTION</code> em vez de <code class="code" id="-e4fwap_80">SAVEPOINT</code></p></li><li class="list__item" id="-e4fwap_76"><p id="-e4fwap_81">N&atilde;o suporta <code class="code" id="-e4fwap_82">RELEASE SAVEPOINT</code></p></li></ul><div class="code-block" data-lang="sql">
BEGIN TRANSACTION;
    INSERT INTO tabela VALUES (1);
    SAVE TRANSACTION sp1;
    INSERT INTO tabela VALUES (2);
    ROLLBACK TRANSACTION sp1;
    INSERT INTO tabela VALUES (3);
COMMIT;
-- Resultado: tabela contém valores 1 e 3
</div></section></section></section><section class="chapter"><h2 id="casos-de-uso" data-toc="casos-de-uso">Casos de Uso</h2><section class="chapter"><h3 id="1-processamento-em-etapas" data-toc="1-processamento-em-etapas">1. Processamento em Etapas</h3><p id="-e4fwap_86">&Uacute;til quando uma transa&ccedil;&atilde;o tem v&aacute;rias etapas l&oacute;gicas e voc&ecirc; deseja poder reverter para o in&iacute;cio de qualquer etapa.</p><div class="code-block" data-lang="sql">
BEGIN;
    -- Etapa 1: Criar pedido
    INSERT INTO pedidos (cliente_id, data) 
    VALUES (101, CURRENT_DATE)
    RETURNING id INTO v_pedido_id;
    
    SAVEPOINT apos_criar_pedido;
    
    -- Etapa 2: Adicionar itens
    INSERT INTO itens_pedido (pedido_id, produto_id, quantidade, preco)
    VALUES 
        (v_pedido_id, 201, 2, 29.90),
        (v_pedido_id, 202, 1, 49.90);
    
    SAVEPOINT apos_adicionar_itens;
    
    -- Etapa 3: Atualizar estoque
    UPDATE produtos SET estoque = estoque - 2 WHERE id = 201;
    UPDATE produtos SET estoque = estoque - 1 WHERE id = 202;
    
    -- Verificar se há estoque suficiente
    IF EXISTS (SELECT 1 FROM produtos WHERE id IN (201, 202) AND estoque &lt; 0) THEN
        -- Desfazer apenas a atualização de estoque
        ROLLBACK TO apos_adicionar_itens;
        -- Marcar pedido como &quot;aguardando estoque&quot;
        UPDATE pedidos SET status = 'AGUARDANDO_ESTOQUE' WHERE id = v_pedido_id;
    END IF;
    
    -- Finalizar transação
    COMMIT;
</div></section><section class="chapter"><h3 id="2-tratamento-de-erros" data-toc="2-tratamento-de-erros">2. Tratamento de Erros</h3><p id="-e4fwap_88">Permite implementar l&oacute;gica de recupera&ccedil;&atilde;o de erros sem abortar toda a transa&ccedil;&atilde;o.</p><div class="code-block" data-lang="sql">
BEGIN;
    -- Operações principais
    INSERT INTO clientes (nome, email) VALUES ('João Silva', 'joao@email.com');
    
    SAVEPOINT apos_cliente;
    
    -- Operações que podem falhar
    BEGIN
        -- Tenta inserir endereço
        INSERT INTO enderecos (cliente_id, cep, logradouro) 
        VALUES (LASTVAL(), '12345-678', 'Rua das Flores, 123');
    EXCEPTION WHEN OTHERS THEN
        -- Se falhar, volta para depois de inserir o cliente
        ROLLBACK TO apos_cliente;
        -- Registra o problema
        INSERT INTO log_erros (operacao, mensagem) 
        VALUES ('inserir_endereco', SQLERRM);
    END;
    
    -- Continua com outras operações
    INSERT INTO contatos (cliente_id, telefone) 
    VALUES (LASTVAL(), '(11) 98765-4321');
    
    COMMIT;
</div></section><section class="chapter"><h3 id="3-valida-o-de-dados-em-etapas" data-toc="3-valida-o-de-dados-em-etapas">3. Valida&ccedil;&atilde;o de Dados em Etapas</h3><p id="-e4fwap_90">Permite validar dados em etapas, revertendo apenas as etapas com problemas.</p><div class="code-block" data-lang="sql">
BEGIN;
    -- Etapa 1: Importar dados de clientes
    INSERT INTO clientes_temp
    SELECT * FROM arquivo_importacao_clientes;
    
    SAVEPOINT apos_importar_clientes;
    
    -- Etapa 2: Validar dados de clientes
    DELETE FROM clientes_temp 
    WHERE email IS NULL OR email NOT LIKE '%@%.%';
    
    -- Verificar se muitos registros foram removidos
    IF (SELECT COUNT(*) FROM clientes_temp) &lt; 
       (SELECT COUNT(*) * 0.9 FROM arquivo_importacao_clientes) THEN
        -- Muitos registros inválidos, voltar e tentar corrigir
        ROLLBACK TO apos_importar_clientes;
        
        -- Tentar corrigir emails
        UPDATE clientes_temp
        SET email = nome || '@dominio.com'
        WHERE email IS NULL OR email NOT LIKE '%@%.%';
    END IF;
    
    SAVEPOINT apos_validar_clientes;
    
    -- Etapa 3: Mover para tabela definitiva
    INSERT INTO clientes
    SELECT * FROM clientes_temp;
    
    COMMIT;
</div></section></section><section class="chapter"><h2 id="pr-ticas-recomendadas" data-toc="pr-ticas-recomendadas">Pr&aacute;ticas Recomendadas</h2><section class="chapter"><h3 id="1-nomea-o-clara-e-consistente" data-toc="1-nomea-o-clara-e-consistente">1. Nomea&ccedil;&atilde;o Clara e Consistente</h3><p id="-e4fwap_93">Use nomes descritivos que indiquem o estado da transa&ccedil;&atilde;o ap&oacute;s cada savepoint:</p><div class="code-block" data-lang="sql">
-- Bom: nomes descritivos
SAVEPOINT apos_criar_cliente;
SAVEPOINT apos_processar_pagamento;
SAVEPOINT apos_atualizar_estoque;

-- Evite: nomes genéricos ou numéricos
SAVEPOINT sp1;
SAVEPOINT ponto2;
SAVEPOINT x123;
</div></section></section><div class="last-modified">09 maio 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="commit-rollback.html" class="navigation-links__prev">Commit e Rollback</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>