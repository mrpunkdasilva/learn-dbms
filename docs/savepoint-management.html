<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#E8488B"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2025-05-09T19:38:33.253523152"><title>Gerenciamento de Savepoints | Database Management Systems: A Complete Guide</title><script type="application/json" id="virtual-toc-data">[{"id":"introdu-o-aos-savepoints","level":0,"title":"Introdução aos Savepoints","anchor":"#introdu-o-aos-savepoints"},{"id":"comandos-b-sicos","level":0,"title":"Comandos Básicos","anchor":"#comandos-b-sicos"},{"id":"comportamento-dos-savepoints","level":0,"title":"Comportamento dos Savepoints","anchor":"#comportamento-dos-savepoints"},{"id":"casos-de-uso","level":0,"title":"Casos de Uso","anchor":"#casos-de-uso"},{"id":"pr-ticas-recomendadas","level":0,"title":"Práticas Recomendadas","anchor":"#pr-ticas-recomendadas"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><link href="static/custom.css" rel="stylesheet"><link rel="icon" type="image/svg" sizes="16x16" href="images/logo-primary.svg"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Gerenciamento de Savepoints | Database Management Systems: A Complete Guide"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Database Management Systems: A Complete Guide Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/savepoint-management.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Gerenciamento de Savepoints | Database Management Systems: A Complete Guide"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/savepoint-management.html#webpage",
    "url": "writerside-documentation/savepoint-management.html",
    "name": "Gerenciamento de Savepoints | Database Management Systems: A Complete Guide",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Database Management Systems: A Complete Guide Help"
}</script><!-- End Schema.org --></head><body data-id="savepoint-management" data-main-title="Gerenciamento de Savepoints" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="sql-fundamentals.md|Fundamentos SQL///sql-tcl.md|Linguagem de Controle de Transação (TCL)"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Database Management Systems: A Complete Guide  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="savepoint-management" id="savepoint-management.md">Gerenciamento de Savepoints</h1><section class="chapter"><h2 id="introdu-o-aos-savepoints" data-toc="introdu-o-aos-savepoints">Introdu&ccedil;&atilde;o aos Savepoints</h2><p id="-kvnevt_8">Savepoints s&atilde;o marcadores dentro de uma transa&ccedil;&atilde;o que permitem o rollback parcial, desfazendo apenas parte das opera&ccedil;&otilde;es realizadas, sem precisar abortar toda a transa&ccedil;&atilde;o.</p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 732.4921875 1135.984375" height="1135.984375" class="flowchart" xmlns="http://www.w3.org/2000/svg" width="732.4921875" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M287.742,62L287.742,66.167C287.742,70.333,287.742,78.667,287.742,84.917C287.742,91.167,287.742,95.333,287.742,98.833C287.742,102.333,287.742,105.167,287.742,106.583L287.742,108"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M287.742,166L287.742,170.167C287.742,174.333,287.742,182.667,287.742,188.917C287.742,195.167,287.742,199.333,287.742,202.833C287.742,206.333,287.742,209.167,287.742,210.583L287.742,212"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_2" d="M287.742,270L287.742,274.167C287.742,278.333,287.742,286.667,287.742,292.917C287.742,299.167,287.742,303.333,287.742,306.833C287.742,310.333,287.742,313.167,287.742,314.583L287.742,316"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_E_3" d="M287.742,374L287.742,378.167C287.742,382.333,287.742,390.667,287.742,396.917C287.742,403.167,287.742,407.333,287.742,410.833C287.742,414.333,287.742,417.167,287.742,418.583L287.742,420"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_F_4" d="M287.742,478L287.742,482.167C287.742,486.333,287.742,494.667,287.742,500.917C287.742,507.167,287.742,511.333,287.742,514.833C287.742,518.333,287.742,521.167,287.742,522.583L287.742,524"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_F_G_5" d="M287.742,582L287.742,586.167C287.742,590.333,287.742,598.667,287.784,604.958C287.826,611.25,287.909,615.5,287.979,619.083C288.049,622.667,288.107,625.584,288.135,627.042L288.164,628.501"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_H_6" d="M248.907,705.149L214.057,719.788C179.206,734.428,109.505,763.706,74.655,791.012C39.805,818.318,39.805,843.651,39.805,866.984C39.805,890.318,39.805,911.651,39.805,932.984C39.805,954.318,39.805,975.651,39.805,994.984C39.805,1014.318,39.805,1031.651,45.931,1042.66C52.057,1053.668,64.31,1058.352,75.94,1062.798C87.57,1067.243,98.577,1071.451,104.08,1073.555L109.584,1075.659"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_I_7" d="M259.354,715.596L245.434,728.494C231.514,741.392,203.675,767.188,189.756,784.17C175.836,801.151,175.836,809.318,175.836,816.818C175.836,824.318,175.836,831.151,175.836,834.568L175.836,837.984"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_J_8" d="M330.895,701.831L379.656,717.024C428.417,732.216,525.939,762.6,574.7,781.876C623.461,801.151,623.461,809.318,623.461,816.818C623.461,824.318,623.461,831.151,623.461,834.568L623.461,837.984"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_K_9" d="M317.131,715.596L330.884,728.494C344.637,741.392,372.143,767.188,385.895,784.17C399.648,801.151,399.648,809.318,399.648,816.818C399.648,824.318,399.648,831.151,399.648,834.568L399.648,837.984"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_I_L_10" d="M175.836,895.984L175.836,902.151C175.836,908.318,175.836,920.651,175.836,929.901C175.836,939.151,175.836,945.318,175.836,950.818C175.836,956.318,175.836,961.151,175.836,963.568L175.836,965.984"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_J_M_11" d="M623.461,895.984L623.461,902.151C623.461,908.318,623.461,920.651,623.461,929.901C623.461,939.151,623.461,945.318,623.461,950.818C623.461,956.318,623.461,961.151,623.461,963.568L623.461,965.984"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_L_H_12" d="M175.836,1023.984L175.836,1028.151C175.836,1032.318,175.836,1040.651,175.836,1046.901C175.836,1053.151,175.836,1057.318,175.836,1060.818C175.836,1064.318,175.836,1067.151,175.836,1068.568L175.836,1069.984"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_M_H_13" d="M623.461,1023.984L623.461,1028.151C623.461,1032.318,623.461,1040.651,591.368,1048.546C559.276,1056.441,495.091,1063.897,431.568,1071.276C368.046,1078.656,305.185,1085.958,273.755,1089.609L242.325,1093.26"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(39.8046875, 932.984375)" class="edgeLabel"><g transform="translate(-31.8046875, -12)" class="label"><foreignObject height="24" width="63.609375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>Tudo OK</p></span></div></foreignObject></g></g><g transform="translate(175.8359375, 792.984375)" class="edgeLabel"><g transform="translate(-97.6796875, -12)" class="label"><foreignObject height="24" width="195.359375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>Problema nas Operações 3</p></span></div></foreignObject></g></g><g transform="translate(623.4609375, 792.984375)" class="edgeLabel"><g transform="translate(-100, -24)" class="label"><foreignObject height="48" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>Problema nas Operações 2 e 3</p></span></div></foreignObject></g></g><g transform="translate(399.6484375, 792.984375)" class="edgeLabel"><g transform="translate(-65.5625, -12)" class="label"><foreignObject height="24" width="131.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>Problema em tudo</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(287.7421875, 35)" id="flowchart-A-48" class="node default"><rect height="54" width="229.03125" y="-27" x="-114.515625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-84.515625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="169.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>BEGIN TRANSACTION</p></span></div></foreignObject></g></g><g transform="translate(287.7421875, 139)" id="flowchart-B-49" class="node default"><rect height="54" width="151.875" y="-27" x="-75.9375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-45.9375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="91.875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Operações 1</p></span></div></foreignObject></g></g><g transform="translate(287.7421875, 243)" id="flowchart-C-51" class="node default"><rect height="54" width="180.65625" y="-27" x="-90.328125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-60.328125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="120.65625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>SAVEPOINT sp1</p></span></div></foreignObject></g></g><g transform="translate(287.7421875, 347)" id="flowchart-D-53" class="node default"><rect height="54" width="151.875" y="-27" x="-75.9375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-45.9375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="91.875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Operações 2</p></span></div></foreignObject></g></g><g transform="translate(287.7421875, 451)" id="flowchart-E-55" class="node default"><rect height="54" width="180.65625" y="-27" x="-90.328125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-60.328125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="120.65625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>SAVEPOINT sp2</p></span></div></foreignObject></g></g><g transform="translate(287.7421875, 555)" id="flowchart-F-57" class="node default"><rect height="54" width="151.875" y="-27" x="-75.9375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-45.9375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="91.875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Operações 3</p></span></div></foreignObject></g></g><g transform="translate(287.7421875, 687.9921875)" id="flowchart-G-59" class="node default"><polygon transform="translate(-55.9921875,55.9921875)" class="label-container" points="55.9921875,0 111.984375,-55.9921875 55.9921875,-111.984375 0,-55.9921875"></polygon><g transform="translate(-28.9921875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="57.984375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Decisão</p></span></div></foreignObject></g></g><g transform="translate(175.8359375, 1100.984375)" id="flowchart-H-61" class="node default"><rect height="54" width="125.03125" y="-27" x="-62.515625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.515625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="65.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>COMMIT</p></span></div></foreignObject></g></g><g transform="translate(175.8359375, 868.984375)" id="flowchart-I-63" class="node default"><rect height="54" width="202.0625" y="-27" x="-101.03125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-71.03125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="142.0625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ROLLBACK TO sp2</p></span></div></foreignObject></g></g><g transform="translate(623.4609375, 868.984375)" id="flowchart-J-65" class="node default"><rect height="54" width="202.0625" y="-27" x="-101.03125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-71.03125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="142.0625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ROLLBACK TO sp1</p></span></div></foreignObject></g></g><g transform="translate(399.6484375, 868.984375)" id="flowchart-K-67" class="node default"><rect height="54" width="145.5625" y="-27" x="-72.78125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-42.78125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="85.5625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ROLLBACK</p></span></div></foreignObject></g></g><g transform="translate(175.8359375, 996.984375)" id="flowchart-L-69" class="node default"><rect height="54" width="188.4375" y="-27" x="-94.21875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.21875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="128.4375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Novas Operações</p></span></div></foreignObject></g></g><g transform="translate(623.4609375, 996.984375)" id="flowchart-M-71" class="node default"><rect height="54" width="188.4375" y="-27" x="-94.21875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.21875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="128.4375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Novas Operações</p></span></div></foreignObject></g></g></g></g></g></svg></section><section class="chapter"><h2 id="comandos-b-sicos" data-toc="comandos-b-sicos">Comandos B&aacute;sicos</h2><section class="chapter"><h3 id="cria-o-de-savepoint" data-toc="cria-o-de-savepoint">Cria&ccedil;&atilde;o de Savepoint</h3><div class="code-block" data-lang="sql">
SAVEPOINT nome_do_savepoint;
</div></section><section class="chapter"><h3 id="rollback-para-um-savepoint" data-toc="rollback-para-um-savepoint">Rollback para um Savepoint</h3><div class="code-block" data-lang="sql">
ROLLBACK TO [SAVEPOINT] nome_do_savepoint;
-- ou em alguns SGBDs
ROLLBACK TRANSACTION TO [SAVEPOINT] nome_do_savepoint;
</div></section><section class="chapter"><h3 id="libera-o-de-savepoint" data-toc="libera-o-de-savepoint">Libera&ccedil;&atilde;o de Savepoint</h3><p id="-kvnevt_15">Em alguns SGBDs, &eacute; poss&iacute;vel liberar um savepoint que n&atilde;o &eacute; mais necess&aacute;rio:</p><div class="code-block" data-lang="sql">
RELEASE SAVEPOINT nome_do_savepoint;
</div></section></section><section class="chapter"><h2 id="comportamento-dos-savepoints" data-toc="comportamento-dos-savepoints">Comportamento dos Savepoints</h2><section class="chapter"><h3 id="ciclo-de-vida" data-toc="ciclo-de-vida">Ciclo de Vida</h3><ul class="list _bullet" id="-kvnevt_20"><li class="list__item" id="-kvnevt_21"><p id="-kvnevt_25"><span class="control" id="-kvnevt_26">Cria&ccedil;&atilde;o</span>: Um savepoint &eacute; criado com o comando <code class="code" id="-kvnevt_27">SAVEPOINT</code></p></li><li class="list__item" id="-kvnevt_22"><p id="-kvnevt_28"><span class="control" id="-kvnevt_29">Uso</span>: Um savepoint pode ser usado como destino de um <code class="code" id="-kvnevt_30">ROLLBACK TO</code></p></li><li class="list__item" id="-kvnevt_23"><p id="-kvnevt_31"><span class="control" id="-kvnevt_32">Libera&ccedil;&atilde;o</span>: Um savepoint pode ser liberado explicitamente com <code class="code" id="-kvnevt_33">RELEASE SAVEPOINT</code></p></li><li class="list__item" id="-kvnevt_24"><p id="-kvnevt_34"><span class="control" id="-kvnevt_35">Descarte</span>: Todos os savepoints s&atilde;o descartados quando a transa&ccedil;&atilde;o &eacute; finalizada com <code class="code" id="-kvnevt_36">COMMIT</code> ou <code class="code" id="-kvnevt_37">ROLLBACK</code></p></li></ul></section><section class="chapter"><h3 id="aninhamento" data-toc="aninhamento">Aninhamento</h3><p id="-kvnevt_38">Savepoints podem ser aninhados, permitindo n&iacute;veis de granularidade no controle de transa&ccedil;&otilde;es:</p><div class="code-block" data-lang="sql">
BEGIN;
    INSERT INTO tabela1 VALUES (1);
    
    SAVEPOINT sp1;
    UPDATE tabela2 SET coluna1 = 'valor1';
    
    SAVEPOINT sp2;
    DELETE FROM tabela3 WHERE id = 5;
    
    -- Desfaz apenas o DELETE
    ROLLBACK TO sp2;
    
    -- Continua a transação
    INSERT INTO tabela4 VALUES (2);
    
    -- Desfaz o UPDATE e o INSERT em tabela4
    ROLLBACK TO sp1;
    
    -- Continua a transação
    UPDATE tabela5 SET coluna1 = 'valor2';
COMMIT;
</div></section><section class="chapter"><h3 id="comportamento-em-diferentes-sgbds" data-toc="comportamento-em-diferentes-sgbds">Comportamento em Diferentes SGBDs</h3><section class="chapter"><h4 id="postgresql" data-toc="postgresql">PostgreSQL</h4><ul class="list _bullet" id="-kvnevt_44"><li class="list__item" id="-kvnevt_46"><p id="-kvnevt_49">Suporta savepoints aninhados</p></li><li class="list__item" id="-kvnevt_47"><p id="-kvnevt_50">Permite <code class="code" id="-kvnevt_51">RELEASE SAVEPOINT</code></p></li><li class="list__item" id="-kvnevt_48"><p id="-kvnevt_52">Savepoints persistem ap&oacute;s <code class="code" id="-kvnevt_53">ROLLBACK TO</code></p></li></ul><div class="code-block" data-lang="sql">
BEGIN;
    INSERT INTO tabela VALUES (1);
    SAVEPOINT sp1;
    INSERT INTO tabela VALUES (2);
    SAVEPOINT sp2;
    INSERT INTO tabela VALUES (3);
    ROLLBACK TO sp1;
    -- Neste ponto, sp2 ainda existe, mas é inútil
    INSERT INTO tabela VALUES (4);
COMMIT;
-- Resultado: tabela contém valores 1 e 4
</div></section><section class="chapter"><h4 id="mysql" data-toc="mysql">MySQL</h4><ul class="list _bullet" id="-kvnevt_54"><li class="list__item" id="-kvnevt_55"><p id="-kvnevt_58">Suporta savepoints aninhados</p></li><li class="list__item" id="-kvnevt_56"><p id="-kvnevt_59">Permite <code class="code" id="-kvnevt_60">RELEASE SAVEPOINT</code></p></li><li class="list__item" id="-kvnevt_57"><p id="-kvnevt_61">Comportamento similar ao PostgreSQL</p></li></ul></section><section class="chapter"><h4 id="oracle" data-toc="oracle">Oracle</h4><ul class="list _bullet" id="-kvnevt_62"><li class="list__item" id="-kvnevt_64"><p id="-kvnevt_67">Suporta savepoints aninhados</p></li><li class="list__item" id="-kvnevt_65"><p id="-kvnevt_68">Permite <code class="code" id="-kvnevt_69">ROLLBACK TO</code> sem a palavra <code class="code" id="-kvnevt_70">SAVEPOINT</code></p></li><li class="list__item" id="-kvnevt_66"><p id="-kvnevt_71">N&atilde;o mant&eacute;m savepoints ap&oacute;s um rollback para um savepoint anterior</p></li></ul><div class="code-block" data-lang="sql">
BEGIN;
    INSERT INTO tabela VALUES (1);
    SAVEPOINT sp1;
    INSERT INTO tabela VALUES (2);
    SAVEPOINT sp2;
    INSERT INTO tabela VALUES (3);
    ROLLBACK TO sp1;
    -- Em Oracle, sp2 não existe mais neste ponto
COMMIT;
</div></section><section class="chapter"><h4 id="sql-server" data-toc="sql-server">SQL Server</h4><ul class="list _bullet" id="-kvnevt_72"><li class="list__item" id="-kvnevt_74"><p id="-kvnevt_77">Suporta savepoints</p></li><li class="list__item" id="-kvnevt_75"><p id="-kvnevt_78">Usa <code class="code" id="-kvnevt_79">SAVE TRANSACTION</code> em vez de <code class="code" id="-kvnevt_80">SAVEPOINT</code></p></li><li class="list__item" id="-kvnevt_76"><p id="-kvnevt_81">N&atilde;o suporta <code class="code" id="-kvnevt_82">RELEASE SAVEPOINT</code></p></li></ul><div class="code-block" data-lang="sql">
BEGIN TRANSACTION;
    INSERT INTO tabela VALUES (1);
    SAVE TRANSACTION sp1;
    INSERT INTO tabela VALUES (2);
    ROLLBACK TRANSACTION sp1;
    INSERT INTO tabela VALUES (3);
COMMIT;
-- Resultado: tabela contém valores 1 e 3
</div></section></section></section><section class="chapter"><h2 id="casos-de-uso" data-toc="casos-de-uso">Casos de Uso</h2><section class="chapter"><h3 id="1-processamento-em-etapas" data-toc="1-processamento-em-etapas">1. Processamento em Etapas</h3><p id="-kvnevt_86">&Uacute;til quando uma transa&ccedil;&atilde;o tem v&aacute;rias etapas l&oacute;gicas e voc&ecirc; deseja poder reverter para o in&iacute;cio de qualquer etapa.</p><div class="code-block" data-lang="sql">
BEGIN;
    -- Etapa 1: Criar pedido
    INSERT INTO pedidos (cliente_id, data) 
    VALUES (101, CURRENT_DATE)
    RETURNING id INTO v_pedido_id;
    
    SAVEPOINT apos_criar_pedido;
    
    -- Etapa 2: Adicionar itens
    INSERT INTO itens_pedido (pedido_id, produto_id, quantidade, preco)
    VALUES 
        (v_pedido_id, 201, 2, 29.90),
        (v_pedido_id, 202, 1, 49.90);
    
    SAVEPOINT apos_adicionar_itens;
    
    -- Etapa 3: Atualizar estoque
    UPDATE produtos SET estoque = estoque - 2 WHERE id = 201;
    UPDATE produtos SET estoque = estoque - 1 WHERE id = 202;
    
    -- Verificar se há estoque suficiente
    IF EXISTS (SELECT 1 FROM produtos WHERE id IN (201, 202) AND estoque &lt; 0) THEN
        -- Desfazer apenas a atualização de estoque
        ROLLBACK TO apos_adicionar_itens;
        -- Marcar pedido como &quot;aguardando estoque&quot;
        UPDATE pedidos SET status = 'AGUARDANDO_ESTOQUE' WHERE id = v_pedido_id;
    END IF;
    
    -- Finalizar transação
    COMMIT;
</div></section><section class="chapter"><h3 id="2-tratamento-de-erros" data-toc="2-tratamento-de-erros">2. Tratamento de Erros</h3><p id="-kvnevt_88">Permite implementar l&oacute;gica de recupera&ccedil;&atilde;o de erros sem abortar toda a transa&ccedil;&atilde;o.</p><div class="code-block" data-lang="sql">
BEGIN;
    -- Operações principais
    INSERT INTO clientes (nome, email) VALUES ('João Silva', 'joao@email.com');
    
    SAVEPOINT apos_cliente;
    
    -- Operações que podem falhar
    BEGIN
        -- Tenta inserir endereço
        INSERT INTO enderecos (cliente_id, cep, logradouro) 
        VALUES (LASTVAL(), '12345-678', 'Rua das Flores, 123');
    EXCEPTION WHEN OTHERS THEN
        -- Se falhar, volta para depois de inserir o cliente
        ROLLBACK TO apos_cliente;
        -- Registra o problema
        INSERT INTO log_erros (operacao, mensagem) 
        VALUES ('inserir_endereco', SQLERRM);
    END;
    
    -- Continua com outras operações
    INSERT INTO contatos (cliente_id, telefone) 
    VALUES (LASTVAL(), '(11) 98765-4321');
    
    COMMIT;
</div></section><section class="chapter"><h3 id="3-valida-o-de-dados-em-etapas" data-toc="3-valida-o-de-dados-em-etapas">3. Valida&ccedil;&atilde;o de Dados em Etapas</h3><p id="-kvnevt_90">Permite validar dados em etapas, revertendo apenas as etapas com problemas.</p><div class="code-block" data-lang="sql">
BEGIN;
    -- Etapa 1: Importar dados de clientes
    INSERT INTO clientes_temp
    SELECT * FROM arquivo_importacao_clientes;
    
    SAVEPOINT apos_importar_clientes;
    
    -- Etapa 2: Validar dados de clientes
    DELETE FROM clientes_temp 
    WHERE email IS NULL OR email NOT LIKE '%@%.%';
    
    -- Verificar se muitos registros foram removidos
    IF (SELECT COUNT(*) FROM clientes_temp) &lt; 
       (SELECT COUNT(*) * 0.9 FROM arquivo_importacao_clientes) THEN
        -- Muitos registros inválidos, voltar e tentar corrigir
        ROLLBACK TO apos_importar_clientes;
        
        -- Tentar corrigir emails
        UPDATE clientes_temp
        SET email = nome || '@dominio.com'
        WHERE email IS NULL OR email NOT LIKE '%@%.%';
    END IF;
    
    SAVEPOINT apos_validar_clientes;
    
    -- Etapa 3: Mover para tabela definitiva
    INSERT INTO clientes
    SELECT * FROM clientes_temp;
    
    COMMIT;
</div></section></section><section class="chapter"><h2 id="pr-ticas-recomendadas" data-toc="pr-ticas-recomendadas">Pr&aacute;ticas Recomendadas</h2><section class="chapter"><h3 id="1-nomea-o-clara-e-consistente" data-toc="1-nomea-o-clara-e-consistente">1. Nomea&ccedil;&atilde;o Clara e Consistente</h3><p id="-kvnevt_93">Use nomes descritivos que indiquem o estado da transa&ccedil;&atilde;o ap&oacute;s cada savepoint:</p><div class="code-block" data-lang="sql">
-- Bom: nomes descritivos
SAVEPOINT apos_criar_cliente;
SAVEPOINT apos_processar_pagamento;
SAVEPOINT apos_atualizar_estoque;

-- Evite: nomes genéricos ou numéricos
SAVEPOINT sp1;
SAVEPOINT ponto2;
SAVEPOINT x123;
</div></section></section><div class="last-modified">09 maio 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="commit-rollback.html" class="navigation-links__prev">Commit e Rollback</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>