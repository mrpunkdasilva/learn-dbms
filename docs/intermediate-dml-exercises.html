<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#E8488B"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2025-06-08T20:09:59.925090094"><title>Exerc&iacute;cios Intermedi&aacute;rios de DML | Database Management Systems: A Complete Guide</title><script type="application/json" id="virtual-toc-data">[{"id":"exerc-cio-1-opera-es-em-lote","level":0,"title":"Exercício 1: Operações em Lote","anchor":"#exerc-cio-1-opera-es-em-lote"},{"id":"exerc-cio-2-consultas-avan-adas-com-join","level":0,"title":"Exercício 2: Consultas Avançadas com JOIN","anchor":"#exerc-cio-2-consultas-avan-adas-com-join"},{"id":"exerc-cio-3-subconsultas-correlacionadas","level":0,"title":"Exercício 3: Subconsultas Correlacionadas","anchor":"#exerc-cio-3-subconsultas-correlacionadas"},{"id":"exerc-cio-4-express-es-de-tabela-comuns-cte","level":0,"title":"Exercício 4: Expressões de Tabela Comuns (CTE)","anchor":"#exerc-cio-4-express-es-de-tabela-comuns-cte"},{"id":"exerc-cio-5-opera-es-com-merge-upsert","level":0,"title":"Exercício 5: Operações com MERGE (UPSERT)","anchor":"#exerc-cio-5-opera-es-com-merge-upsert"},{"id":"exerc-cio-6-manipula-o-de-dados-temporais","level":0,"title":"Exercício 6: Manipulação de Dados Temporais","anchor":"#exerc-cio-6-manipula-o-de-dados-temporais"},{"id":"exerc-cio-7-opera-es-com-json","level":0,"title":"Exercício 7: Operações com JSON","anchor":"#exerc-cio-7-opera-es-com-json"},{"id":"exerc-cio-8-opera-es-com-dados-geoespaciais","level":0,"title":"Exercício 8: Operações com Dados Geoespaciais","anchor":"#exerc-cio-8-opera-es-com-dados-geoespaciais"},{"id":"crit-rios-de-avalia-o","level":0,"title":"Critérios de Avaliação","anchor":"#crit-rios-de-avalia-o"},{"id":"dicas-de-estudo","level":0,"title":"Dicas de Estudo","anchor":"#dicas-de-estudo"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><link href="static/custom.css" rel="stylesheet"><link rel="icon" type="image/svg" sizes="16x16" href="images/logo-primary.svg"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Exerc&iacute;cios Intermedi&aacute;rios de DML | Database Management Systems: A Complete Guide"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Database Management Systems: A Complete Guide Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/intermediate-dml-exercises.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Exerc&iacute;cios Intermedi&aacute;rios de DML | Database Management Systems: A Complete Guide"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/intermediate-dml-exercises.html#webpage",
    "url": "writerside-documentation/intermediate-dml-exercises.html",
    "name": "Exerc&iacute;cios Intermedi&aacute;rios de DML | Database Management Systems: A Complete Guide",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Database Management Systems: A Complete Guide Help"
}</script><!-- End Schema.org --></head><body data-id="intermediate-dml-exercises" data-main-title="Exercícios Intermediários de DML" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="sql-fundamentals.md|Fundamentos SQL///sql-dml.md|DML - Linguagem de Manipulação de Dados///dml-exercises.md|Exercícios de DML (Data Manipulation Language)"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Database Management Systems: A Complete Guide  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="intermediate-dml-exercises" id="intermediate-dml-exercises.md">Exercícios Intermediários de DML</h1><section class="chapter"><h2 id="exerc-cio-1-opera-es-em-lote" data-toc="exerc-cio-1-opera-es-em-lote">Exerc&iacute;cio 1: Opera&ccedil;&otilde;es em Lote</h2><section class="chapter"><h3 id="descri-o" data-toc="descri-o">Descri&ccedil;&atilde;o</h3><p id="-h091wh_16">Pratique opera&ccedil;&otilde;es DML em lote para manipular m&uacute;ltiplos registros de forma eficiente.</p></section><section class="chapter"><h3 id="requisitos" data-toc="requisitos">Requisitos</h3><ul class="list _bullet" id="-h091wh_17"><li class="list__item" id="-h091wh_18"><p id="-h091wh_22">Inser&ccedil;&atilde;o em lote com SELECT</p></li><li class="list__item" id="-h091wh_19"><p id="-h091wh_23">Atualiza&ccedil;&atilde;o em lote com JOIN</p></li><li class="list__item" id="-h091wh_20"><p id="-h091wh_24">Exclus&atilde;o em lote com subconsulta</p></li><li class="list__item" id="-h091wh_21"><p id="-h091wh_25">Opera&ccedil;&otilde;es condicionais em lote</p></li></ul></section><section class="chapter"><h3 id="solu-o" data-toc="solu-o">Solu&ccedil;&atilde;o</h3><div class="code-block" data-lang="sql">
-- Inserção em lote com SELECT
INSERT INTO pratica.controle_exercicios (exercicio, completado)
SELECT 'Exercício ' || id, false
FROM generate_series(1, 10) as id;

-- Atualização em lote com JOIN
UPDATE pratica.produtos p
SET estoque = p.estoque - ip.quantidade
FROM pratica.itens_pedido ip
JOIN pratica.pedidos pe ON ip.pedido_id = pe.id
WHERE ip.produto_id = p.id
AND pe.status = 'Aprovado'
AND pe.data_pedido &gt;= CURRENT_DATE - INTERVAL '1 day';

-- Exclusão em lote com subconsulta
DELETE FROM pratica.itens_pedido
WHERE pedido_id IN (
    SELECT id
    FROM pratica.pedidos
    WHERE status = 'Cancelado'
    AND data_pedido &lt; CURRENT_DATE - INTERVAL '90 days'
);

-- Operações condicionais em lote
UPDATE pratica.produtos
SET 
    preco = CASE
        WHEN estoque &gt; 100 THEN preco * 0.9  -- Desconto para produtos com muito estoque
        WHEN estoque &lt; 10 THEN preco * 1.1   -- Aumento para produtos com pouco estoque
        ELSE preco                           -- Mantém o preço para estoque normal
    END,
    nome = CASE
        WHEN nome NOT LIKE '%Novo%' AND data_cadastro &gt; CURRENT_DATE - INTERVAL '30 days'
        THEN nome || ' (Novo)'
        ELSE nome
    END;
</div></section></section><section class="chapter"><h2 id="exerc-cio-2-consultas-avan-adas-com-join" data-toc="exerc-cio-2-consultas-avan-adas-com-join">Exerc&iacute;cio 2: Consultas Avan&ccedil;adas com JOIN</h2><section class="chapter"><h3 id="descri-o" data-toc="descri-o">Descri&ccedil;&atilde;o</h3><p id="-h091wh_30">Pratique consultas mais complexas utilizando diferentes tipos de JOIN.</p></section><section class="chapter"><h3 id="requisitos" data-toc="requisitos">Requisitos</h3><ul class="list _bullet" id="-h091wh_31"><li class="list__item" id="-h091wh_32"><p id="-h091wh_36">INNER JOIN com m&uacute;ltiplas tabelas</p></li><li class="list__item" id="-h091wh_33"><p id="-h091wh_37">LEFT/RIGHT JOIN com condi&ccedil;&otilde;es</p></li><li class="list__item" id="-h091wh_34"><p id="-h091wh_38">FULL OUTER JOIN</p></li><li class="list__item" id="-h091wh_35"><p id="-h091wh_39">CROSS JOIN</p></li></ul></section><section class="chapter"><h3 id="solu-o" data-toc="solu-o">Solu&ccedil;&atilde;o</h3><div class="code-block" data-lang="sql">
-- INNER JOIN com múltiplas tabelas
SELECT 
    c.nome as cliente,
    p.id as pedido_id,
    p.data_pedido,
    SUM(ip.quantidade * ip.preco_unitario) as valor_total
FROM pratica.clientes c
JOIN pratica.pedidos p ON c.id = p.cliente_id
JOIN pratica.itens_pedido ip ON p.id = ip.pedido_id
GROUP BY c.nome, p.id, p.data_pedido
ORDER BY p.data_pedido DESC;

-- LEFT/RIGHT JOIN com condições
SELECT 
    c.nome as cliente,
    COUNT(p.id) as total_pedidos,
    COALESCE(SUM(ip.quantidade * ip.preco_unitario), 0) as valor_total_compras
FROM pratica.clientes c
LEFT JOIN pratica.pedidos p ON c.id = p.cliente_id AND p.status != 'Cancelado'
LEFT JOIN pratica.itens_pedido ip ON p.id = ip.pedido_id
GROUP BY c.nome
ORDER BY valor_total_compras DESC;

-- FULL OUTER JOIN
SELECT 
    c.nome as cliente,
    p.id as pedido_id,
    p.status
FROM pratica.clientes c
FULL OUTER JOIN pratica.pedidos p ON c.id = p.cliente_id
WHERE c.id IS NULL OR p.id IS NULL;

-- CROSS JOIN
SELECT 
    c.nome as cliente,
    pr.nome as produto,
    'Potencial interesse' as status
FROM pratica.clientes c
CROSS JOIN pratica.produtos pr
WHERE pr.categoria = 'Eletrônicos'
AND NOT EXISTS (
    SELECT 1 FROM pratica.pedidos p
    JOIN pratica.itens_pedido ip ON p.id = ip.pedido_id
    WHERE p.cliente_id = c.id
    AND ip.produto_id = pr.id
);
</div></section></section><section class="chapter"><h2 id="exerc-cio-3-subconsultas-correlacionadas" data-toc="exerc-cio-3-subconsultas-correlacionadas">Exerc&iacute;cio 3: Subconsultas Correlacionadas</h2><section class="chapter"><h3 id="descri-o" data-toc="descri-o">Descri&ccedil;&atilde;o</h3><p id="-h091wh_44">Pratique o uso de subconsultas correlacionadas para resolver problemas complexos.</p></section><section class="chapter"><h3 id="requisitos" data-toc="requisitos">Requisitos</h3><ul class="list _bullet" id="-h091wh_45"><li class="list__item" id="-h091wh_46"><p id="-h091wh_50">Subconsulta correlacionada no WHERE</p></li><li class="list__item" id="-h091wh_47"><p id="-h091wh_51">Subconsulta correlacionada no SELECT</p></li><li class="list__item" id="-h091wh_48"><p id="-h091wh_52">Subconsulta com EXISTS/NOT EXISTS</p></li><li class="list__item" id="-h091wh_49"><p id="-h091wh_53">Subconsulta com operadores de compara&ccedil;&atilde;o</p></li></ul></section><section class="chapter"><h3 id="solu-o" data-toc="solu-o">Solu&ccedil;&atilde;o</h3><div class="code-block" data-lang="sql">
-- Subconsulta correlacionada no WHERE
SELECT c.nome, c.email
FROM pratica.clientes c
WHERE (
    SELECT COUNT(*)
    FROM pratica.pedidos p
    WHERE p.cliente_id = c.id
) &gt; 3;

-- Subconsulta correlacionada no SELECT
SELECT 
    p.nome as produto,
    p.preco,
    (
        SELECT AVG(ip.preco_unitario)
        FROM pratica.itens_pedido ip
        WHERE ip.produto_id = p.id
    ) as preco_medio_vendido
FROM pratica.produtos p;

-- Subconsulta com EXISTS/NOT EXISTS
SELECT c.nome
FROM pratica.clientes c
WHERE EXISTS (
    SELECT 1
    FROM pratica.pedidos p
    JOIN pratica.itens_pedido ip ON p.id = ip.pedido_id
    JOIN pratica.produtos pr ON ip.produto_id = pr.id
    WHERE p.cliente_id = c.id
    AND pr.preco &gt; 1000
);

-- Subconsulta com operadores de comparação
SELECT p.nome, p.preco
FROM pratica.produtos p
WHERE p.preco &gt; ALL (
    SELECT AVG(preco)
    FROM pratica.produtos
    GROUP BY categoria
);
</div></section></section><section class="chapter"><h2 id="exerc-cio-4-express-es-de-tabela-comuns-cte" data-toc="exerc-cio-4-express-es-de-tabela-comuns-cte">Exerc&iacute;cio 4: Express&otilde;es de Tabela Comuns (CTE)</h2><section class="chapter"><h3 id="descri-o" data-toc="descri-o">Descri&ccedil;&atilde;o</h3><p id="-h091wh_58">Pratique o uso de CTEs para simplificar consultas complexas.</p></section><section class="chapter"><h3 id="requisitos" data-toc="requisitos">Requisitos</h3><ul class="list _bullet" id="-h091wh_59"><li class="list__item" id="-h091wh_60"><p id="-h091wh_64">CTE b&aacute;sica</p></li><li class="list__item" id="-h091wh_61"><p id="-h091wh_65">CTE com m&uacute;ltiplas refer&ecirc;ncias</p></li><li class="list__item" id="-h091wh_62"><p id="-h091wh_66">CTE recursiva</p></li><li class="list__item" id="-h091wh_63"><p id="-h091wh_67">CTE com opera&ccedil;&otilde;es DML</p></li></ul></section><section class="chapter"><h3 id="solu-o" data-toc="solu-o">Solu&ccedil;&atilde;o</h3><div class="code-block" data-lang="sql">
-- CTE básica
WITH pedidos_recentes AS (
    SELECT *
    FROM pratica.pedidos
    WHERE data_pedido &gt;= CURRENT_DATE - INTERVAL '30 days'
)
SELECT 
    c.nome as cliente,
    COUNT(pr.id) as total_pedidos_recentes
FROM pratica.clientes c
LEFT JOIN pedidos_recentes pr ON c.id = pr.cliente_id
GROUP BY c.nome;

-- CTE com múltiplas referências
WITH 
    pedidos_por_cliente AS (
        SELECT 
            cliente_id,
            COUNT(*) as total_pedidos,
            SUM(valor_total) as valor_total
        FROM pratica.pedidos
        GROUP BY cliente_id
    ),
    clientes_vip AS (
        SELECT cliente_id
        FROM pedidos_por_cliente
        WHERE total_pedidos &gt;= 5 OR valor_total &gt;= 5000
    )
SELECT 
    c.nome,
    c.email,
    'VIP' as status
FROM pratica.clientes c
JOIN clientes_vip vip ON c.id = vip.cliente_id;

-- CTE recursiva
WITH RECURSIVE hierarquia_categorias AS (
    -- Caso base: categorias raiz (sem pai)
    SELECT id, nome, 0 as nivel
    FROM pratica.categorias
    WHERE categoria_pai_id IS NULL
    
    UNION ALL
    
    -- Caso recursivo: categorias filhas
    SELECT c.id, c.nome, h.nivel + 1
    FROM pratica.categorias c
    JOIN hierarquia_categorias h ON c.categoria_pai_id = h.id
)
SELECT 
    REPEAT('  ', nivel) || nome as categoria_hierarquia,
    nivel
FROM hierarquia_categorias
ORDER BY nivel, nome;

-- CTE com operações DML
WITH produtos_sem_movimento AS (
    SELECT p.id
    FROM pratica.produtos p
    LEFT JOIN pratica.itens_pedido ip ON p.id = ip.produto_id
    WHERE ip.produto_id IS NULL
    AND p.data_cadastro &lt; CURRENT_DATE - INTERVAL '180 days'
)
UPDATE pratica.produtos
SET estoque = 0
WHERE id IN (SELECT id FROM produtos_sem_movimento);
</div></section></section><section class="chapter"><h2 id="exerc-cio-5-opera-es-com-merge-upsert" data-toc="exerc-cio-5-opera-es-com-merge-upsert">Exerc&iacute;cio 5: Opera&ccedil;&otilde;es com MERGE (UPSERT)</h2><section class="chapter"><h3 id="descri-o" data-toc="descri-o">Descri&ccedil;&atilde;o</h3><p id="-h091wh_72">Pratique opera&ccedil;&otilde;es de inser&ccedil;&atilde;o/atualiza&ccedil;&atilde;o condicional.</p></section><section class="chapter"><h3 id="requisitos" data-toc="requisitos">Requisitos</h3><ul class="list _bullet" id="-h091wh_73"><li class="list__item" id="-h091wh_74"><p id="-h091wh_78">INSERT ... ON CONFLICT (PostgreSQL)</p></li><li class="list__item" id="-h091wh_75"><p id="-h091wh_79">MERGE (SQL Server/Oracle)</p></li><li class="list__item" id="-h091wh_76"><p id="-h091wh_80">Atualiza&ccedil;&atilde;o condicional</p></li><li class="list__item" id="-h091wh_77"><p id="-h091wh_81">Inser&ccedil;&atilde;o condicional</p></li></ul></section><section class="chapter"><h3 id="solu-o" data-toc="solu-o">Solu&ccedil;&atilde;o</h3><div class="code-block" data-lang="sql">
-- INSERT ... ON CONFLICT (PostgreSQL)
INSERT INTO pratica.produtos (codigo, nome, preco, estoque)
VALUES 
    ('PROD001', 'Smartphone X', 1299.99, 50),
    ('PROD008', 'Câmera Digital', 899.99, 25)
ON CONFLICT (codigo) 
DO UPDATE SET
    nome = EXCLUDED.nome,
    preco = EXCLUDED.preco,
    estoque = pratica.produtos.estoque + EXCLUDED.estoque;

-- Simulação de MERGE para bancos que não suportam nativamente
-- Atualização condicional
WITH dados_novos (codigo, nome, preco, estoque) AS (
    VALUES 
        ('PROD001', 'Smartphone X Pro', 1499.99, 10),
        ('PROD009', 'Smartwatch', 399.99, 30)
)
UPDATE pratica.produtos p
SET 
    nome = d.nome,
    preco = d.preco,
    estoque = p.estoque + d.estoque
FROM dados_novos d
WHERE p.codigo = d.codigo;

-- Inserção condicional
WITH dados_novos (codigo, nome, preco, estoque) AS (
    VALUES 
        ('PROD001', 'Smartphone X Pro', 1499.99, 10),
        ('PROD009', 'Smartwatch', 399.99, 30)
),
atualizados AS (
    UPDATE pratica.produtos p
    SET 
        nome = d.nome,
        preco = d.preco,
        estoque = p.estoque + d.estoque
    FROM dados_novos d
    WHERE p.codigo = d.codigo
    RETURNING p.codigo
)
INSERT INTO pratica.produtos (codigo, nome, preco, estoque)
SELECT d.codigo, d.nome, d.preco, d.estoque
FROM dados_novos d
WHERE NOT EXISTS (
    SELECT 1 FROM atualizados a
    WHERE a.codigo = d.codigo
);
</div></section></section><section class="chapter"><h2 id="exerc-cio-6-manipula-o-de-dados-temporais" data-toc="exerc-cio-6-manipula-o-de-dados-temporais">Exerc&iacute;cio 6: Manipula&ccedil;&atilde;o de Dados Temporais</h2><section class="chapter"><h3 id="descri-o" data-toc="descri-o">Descri&ccedil;&atilde;o</h3><p id="-h091wh_86">Pratique opera&ccedil;&otilde;es DML com dados temporais.</p></section><section class="chapter"><h3 id="requisitos" data-toc="requisitos">Requisitos</h3><ul class="list _bullet" id="-h091wh_87"><li class="list__item" id="-h091wh_88"><p id="-h091wh_92">Filtros por data/hora</p></li><li class="list__item" id="-h091wh_89"><p id="-h091wh_93">C&aacute;lculos com intervalos de tempo</p></li><li class="list__item" id="-h091wh_90"><p id="-h091wh_94">Agrupamento por per&iacute;odos</p></li><li class="list__item" id="-h091wh_91"><p id="-h091wh_95">Compara&ccedil;&otilde;es temporais</p></li></ul></section><section class="chapter"><h3 id="solu-o" data-toc="solu-o">Solu&ccedil;&atilde;o</h3><div class="code-block" data-lang="sql">
-- Filtros por data/hora
SELECT *
FROM pratica.pedidos
WHERE 
    data_pedido &gt;= CURRENT_DATE - INTERVAL '30 days'
    AND EXTRACT(HOUR FROM data_pedido) BETWEEN 9 AND 18;

-- Cálculos com intervalos de tempo
SELECT 
    id,
    data_pedido,
    data_entrega,
    data_entrega - data_pedido AS tempo_processamento,
    EXTRACT(DAY FROM (data_entrega - data_pedido)) AS dias_processamento
FROM pratica.pedidos
WHERE status = 'Entregue';

-- Agrupamento por períodos
SELECT 
    DATE_TRUNC('month', data_pedido) AS mes,
    COUNT(*) AS total_pedidos,
    SUM(valor_total) AS valor_total,
    AVG(valor_total) AS ticket_medio
FROM pratica.pedidos
WHERE data_pedido &gt;= CURRENT_DATE - INTERVAL '1 year'
GROUP BY mes
ORDER BY mes;

-- Comparações temporais
UPDATE pratica.pedidos
SET status = 'Atrasado'
WHERE 
    status = 'Em Processamento'
    AND data_pedido &lt; CURRENT_DATE - INTERVAL '3 days';
</div></section></section><section class="chapter"><h2 id="exerc-cio-7-opera-es-com-json" data-toc="exerc-cio-7-opera-es-com-json">Exerc&iacute;cio 7: Opera&ccedil;&otilde;es com JSON</h2><section class="chapter"><h3 id="descri-o" data-toc="descri-o">Descri&ccedil;&atilde;o</h3><p id="-h091wh_100">Pratique opera&ccedil;&otilde;es DML com dados em formato JSON.</p></section><section class="chapter"><h3 id="requisitos" data-toc="requisitos">Requisitos</h3><ul class="list _bullet" id="-h091wh_101"><li class="list__item" id="-h091wh_102"><p id="-h091wh_106">Consulta de dados JSON</p></li><li class="list__item" id="-h091wh_103"><p id="-h091wh_107">Atualiza&ccedil;&atilde;o de dados JSON</p></li><li class="list__item" id="-h091wh_104"><p id="-h091wh_108">Filtragem por valores JSON</p></li><li class="list__item" id="-h091wh_105"><p id="-h091wh_109">Transforma&ccedil;&atilde;o JSON para tabela</p></li></ul></section><section class="chapter"><h3 id="solu-o" data-toc="solu-o">Solu&ccedil;&atilde;o</h3><div class="code-block" data-lang="sql">
-- Consulta de dados JSON
SELECT 
    id,
    nome,
    dados_adicionais-&gt;&gt;'endereco' AS endereco,
    dados_adicionais-&gt;'contatos'-&gt;&gt;'telefone' AS telefone
FROM pratica.clientes
WHERE dados_adicionais-&gt;&gt;'tipo' = 'Pessoa Física';

-- Atualização de dados JSON
UPDATE pratica.clientes
SET dados_adicionais = jsonb_set(
    dados_adicionais,
    '{endereco}',
    '&quot;Rua Nova, 123&quot;'::jsonb
)
WHERE id = 1;

-- Filtragem por valores JSON
SELECT *
FROM pratica.produtos
WHERE 
    dados_tecnicos-&gt;'dimensoes'-&gt;&gt;'altura' &gt; '10'
    AND dados_tecnicos-&gt;'compatibilidade' ? 'Android';

-- Transformação JSON para tabela
SELECT 
    p.id,
    p.nome,
    a.valor-&gt;&gt;'nome' AS atributo_nome,
    a.valor-&gt;&gt;'valor' AS atributo_valor
FROM 
    pratica.produtos p,
    jsonb_array_elements(p.atributos) WITH ORDINALITY AS a(valor, idx)
ORDER BY p.id, a.idx;
</div></section></section><section class="chapter"><h2 id="exerc-cio-8-opera-es-com-dados-geoespaciais" data-toc="exerc-cio-8-opera-es-com-dados-geoespaciais">Exerc&iacute;cio 8: Opera&ccedil;&otilde;es com Dados Geoespaciais</h2><section class="chapter"><h3 id="descri-o" data-toc="descri-o">Descri&ccedil;&atilde;o</h3><p id="-h091wh_114">Pratique opera&ccedil;&otilde;es DML com dados geoespaciais.</p></section><section class="chapter"><h3 id="requisitos" data-toc="requisitos">Requisitos</h3><ul class="list _bullet" id="-h091wh_115"><li class="list__item" id="-h091wh_116"><p id="-h091wh_120">Consulta por proximidade</p></li><li class="list__item" id="-h091wh_117"><p id="-h091wh_121">C&aacute;lculo de dist&acirc;ncias</p></li><li class="list__item" id="-h091wh_118"><p id="-h091wh_122">Filtragem por regi&atilde;o</p></li><li class="list__item" id="-h091wh_119"><p id="-h091wh_123">Agrupamento por &aacute;rea</p></li></ul></section><section class="chapter"><h3 id="solu-o" data-toc="solu-o">Solu&ccedil;&atilde;o</h3><div class="code-block" data-lang="sql">
-- Consulta por proximidade
SELECT 
    id,
    nome,
    ST_Distance(
        localizacao,
        ST_SetSRID(ST_MakePoint(-23.5505, -46.6333), 4326)
    ) AS distancia_km
FROM pratica.lojas
ORDER BY distancia_km
LIMIT 5;

-- Cálculo de distâncias
UPDATE pratica.entregas
SET 
    distancia_km = ST_Distance(
        origem::geography,
        destino::geography
    ) / 1000,
    valor_frete = (ST_Distance(
        origem::geography,
        destino::geography
    ) / 1000) * 2.50  -- R$ 2,50 por km
WHERE status = 'Pendente';

-- Filtragem por região
SELECT 
    c.nome,
    c.email
FROM pratica.clientes c
WHERE ST_Contains(
    (SELECT area FROM pratica.regioes WHERE nome = 'Zona Sul'),
    c.endereco_geo
);

-- Agrupamento por área
SELECT 
    r.nome AS regiao,
    COUNT(c.id) AS total_clientes,
    AVG(c.limite_credito) AS limite_medio
FROM pratica.regioes r
JOIN pratica.clientes c ON ST_Contains(r.area, c.endereco_geo)
GROUP BY r.nome
ORDER BY total_clientes DESC;
</div></section></section><section class="chapter"><h2 id="crit-rios-de-avalia-o" data-toc="crit-rios-de-avalia-o">Crit&eacute;rios de Avalia&ccedil;&atilde;o</h2><ul class="list _bullet" id="-h091wh_125"><li class="list__item" id="-h091wh_126"><p id="-h091wh_131">Sintaxe correta e otimizada</p></li><li class="list__item" id="-h091wh_127"><p id="-h091wh_132">Uso adequado de recursos intermedi&aacute;rios</p></li><li class="list__item" id="-h091wh_128"><p id="-h091wh_133">Efici&ecirc;ncia das consultas</p></li><li class="list__item" id="-h091wh_129"><p id="-h091wh_134">Integridade dos dados ap&oacute;s manipula&ccedil;&atilde;o</p></li><li class="list__item" id="-h091wh_130"><p id="-h091wh_135">Aplica&ccedil;&atilde;o de boas pr&aacute;ticas</p></li></ul></section><section class="chapter"><h2 id="dicas-de-estudo" data-toc="dicas-de-estudo">Dicas de Estudo</h2><ul class="list _bullet" id="-h091wh_136"><li class="list__item" id="-h091wh_137"><p id="-h091wh_142">Analise o plano de execu&ccedil;&atilde;o das consultas</p></li><li class="list__item" id="-h091wh_138"><p id="-h091wh_143">Compare diferentes abordagens para o mesmo problema</p></li><li class="list__item" id="-h091wh_139"><p id="-h091wh_144">Teste com conjuntos de dados maiores</p></li><li class="list__item" id="-h091wh_140"><p id="-h091wh_145">Verifique o impacto de &iacute;ndices nas consultas</p></li><li class="list__item" id="-h091wh_141"><p id="-h091wh_146">Pratique a escrita de consultas sem consultar exemplos</p></li></ul></section><div class="last-modified">09 maio 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="basic-dml-exercises.html" class="navigation-links__prev">Exerc&iacute;cios B&aacute;sicos de DML</a><a href="advanced-dml-exercises.html" class="navigation-links__next">Exerc&iacute;cios Avan&ccedil;ados de DML</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>